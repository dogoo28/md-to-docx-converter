# MarkdownToDocx 開發對話紀錄 (Vibe Coding Session Log)
**日期**: 2026-01-05
**專案**: MarkdownToDocx (專業級 Markdown 轉 Word 工具)
**目標**: 將基本的 Markdown 轉換器升級為支援商業級文件輸出的工具 (合併輸出、樣式管理、Metadata)。

本文件記錄了 User (開發者) 與 AI (Antigravity) 之間的協作歷程，重點在於針對文件排版細節的修正 (OpenXML) 與使用者體驗的優化 (樣式預覽、預覽視窗管理)。

---

## 1. 系統功能增強 (System Enhancements)
*   **User指令**: 希望加入新功能，包括 Metadata 編輯、合併輸出、以及預覽功能。
*   **AI行動**: 
    1.  **Metadata**: 在側邊欄增加標題、作者、日期輸入框，並傳參給 Pandoc (`--metadata`).
    2.  **合併輸出 (Merge)**: 實作多檔上傳邏輯，將多個 Markdown 內容串接後一次轉換。
    3.  **排序功能**: 為了滿足合併需求，新增了 `st.multiselect` 讓使用者調整檔案順序。
    4.  **預覽系統**: 實作了 Markdown 內容預覽 (Tab 分頁) 與 Word 樣式預覽。
*   **Vibe特徵**: Feature-First 開發。快速將需求轉化為可互動的 Streamlit 元件。

## 2. 核心轉換優化 (Conversion Core Logic)
*   **User指令**: 指出合併後分頁符號失效、目錄消失，以及生成的圖片殘留問題。
*   **AI行動**:
    1.  **OpenXML 注入**: 發現 Latex 的 `\newpage` 在 Pandoc 轉 Docx 時無效，改用 Raw OpenXML `<w:br w:type="page"/>` 解決分頁問題。
    2.  **TOC 強制生成**: 增加 `toc-title:目錄` metadata，強制引導 Pandoc 生成目錄區塊。
    3.  **圖片管理**: 移除了 `--extract-media=.` 參數，改用暫存區處理圖片，並實作自動清理邏輯，解決根目錄污染問題。
*   **Vibe特徵**: **Deep Dive Debugging**。處理跨格式轉換 (MD -> Docx) 的底層細節，確保格式精準度。

## 3. 樣式預覽 (Style Preview) 迭代
*   **User指令**: 「樣式表缺失字形設定」、「側邊欄太窄難以閱讀」。
*   **AI行動**:
    1.  **深度解析**: 利用 `python-docx` 深入挖掘 `rPr` (Run Properties) 若有設定字型、大小、顏色，則提取並顯示。
    2.  **版面重構**: 將原本擠在側邊欄的樣式表格移至主畫面中央，改用寬版 `Expandable` 呈現，大幅提升易讀性。
*   **Vibe特徵**: UX Refinement。從「有功能」進化到「好用」，根據視覺反饋即時調整版面。

## 4. 文件化與版本控制 (Documentation & Version Control)
*   **User指令**: 「簽入 GIT」、「/doc-update」。
*   **AI行動**: 
    1.  建立 `系統文件/` 目錄結構。
    2.  撰寫 `README.md`、`文件清單.md` 與 `操作手冊.md`。
    3.  執行 Git Commit & Push，確保程式碼與文件同步上傳。

---

## 總結 (Summary)
本次 Session 成功將一個基礎的轉換腳本轉變為一個具備生產力的圖形化工具。
1.  **完成度**: 所有預定功能 (合併、Metadata、樣式) 皆已上線且經過驗證。
2.  **穩定性**: 解決了底層的分頁與目錄生成 Bug。
3.  **待處理**: 目前暫無，系統已達穩定發布狀態。

**關鍵代碼變更檔**:
- `app.py` (UI/UX, Logic)
- `README.md` (Docs)
- `系統文件/操作手冊.md` (Docs)
