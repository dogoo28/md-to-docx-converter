# MarkdownToDocx 開發對話紀錄 (Vibe Coding Session Log)
**日期**: 2026-01-09
**專案**: MarkdownToDocx (專業級 Markdown 轉 Word 工具)
**目標**: 系統架構重構 (Modularization) 與功能優化 (Live Preview)

本文件記錄了 User (開發者) 與 AI (Antigravity) 之間的協作歷程，重點在於針對系統長遠維護性的架構調整，以及響應使用者需求恢復並增強預覽功能。

---

## 1. 系統架構重構 (Refactoring)
*   **User指令**: 希望對目前系統功能提出建議。
*   **AI建議**: 提出模組化、i18n 與即時預覽等建議。User 同意優先執行模組化。
*   **AI行動**: 
    1.  **建立 `core/` 套件**: 將業務邏輯從 `app.py` 分離。
    2.  **拆分 `converter.py`**: 封裝 `process_mermaid_to_local_img` 與 `convert_md_to_docx`。
    3.  **拆分 `style_analyzer.py`**: 封裝 `get_docx_style_info`。
    4.  **相依性管理**: 更新 `requirements.txt` 加入 `pandas` (用於樣式分析)。
*   **Vibe特徵**: **Clean Code**。將 400+ 行的 `app.py` 瘦身，使職責分離 (Separation of Concerns)，提升可讀性與可測試性。

## 2. 即時預覽功能回歸 (Live Preview Restoration)
*   **User指令**: 「及時預覽功能之前有做好了，只是後來拿掉而已...除非你能把功能改為上傳多個檔案後能把她們依順序接在一起來預覽」。
*   **AI行動**:
    1.  **合併預覽邏輯**: 在 `app.py` 中實作邏輯，讀取所有上傳檔案 (依排序後順序)。
    2.  **內容串接**: 將各檔案內容以 Markdown 分隔線 (`---`) 連接，並標註檔名。
    3.  **IO 指標重置**: 確保讀取預覽後執行 `f.seek(0)`，避免影響後續的轉換流程。
    4.  **UI 呈現**: 使用 `st.expander` 包裝，預設摺疊以保持介面整潔。
*   **Vibe特徵**: User-Centric Design。快速回應使用者對於「多檔預覽」的具體痛點，提供直觀的解決方案。

## 3. 文件更新 (Documentation)
*   **User指令**: `doc-update`
*   **AI行動**: 
    1.  更新 `README.md` 專案結構說明。
    2.  更新 `系統文件/此文件清單.md` 與 `操作手冊.md`。

---

## 總結 (Summary)
本次 Session 提升了專案的工程品質 (Engineering Quality) 與使用者體驗 (UX)。
1.  **架構面**: 完成核心與 UI 的分離，為未來功能擴展打好地基。
2.  **功能面**: 重新實現了更強大的「合併預覽」功能。
3.  **待處理**: 
    -   多語系支援 (i18n)。
    -   離線圖表渲染備援機制。

**關鍵代碼變更檔**:
- `core/converter.py` [NEW]
- `core/style_analyzer.py` [NEW]
- `app.py` [MODIFIED]
- `requirements.txt` [MODIFIED]
